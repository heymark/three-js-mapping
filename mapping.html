<!DOCTYPE html>
<html lang="en">

<head>
    <title>Three.js Mapping Test</title>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0'>
    <link rel="stylesheet" type="text/css" href="style/style.css">
    <script src='js/three.min.js'></script>
    <script src='js/BoxGeometry.js'></script>
    <script src='js/Detector.js'></script>
    <script src='js/OrbitControls.js'></script>
</head>

<body>
    <div id="container"></div>
    <script>
        window.onload = function () {

            if (!Detector.webgl) {
                Detector.addGetWebGLMessage();
            }

            var box, boxMaterial, boxModel, boxNormal, boxSpec, boxTexture, container, scene, camera, renderer;

            function addLight() {

                var ambientLight = new THREE.AmbientLight(0xc0c0c0);
                scene.add(ambientLight);

                var directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
                directionalLight.position.set(1, 1.5, 0);
                scene.add(directionalLight);

                var hemiLight = new THREE.HemisphereLight(0xff0000, 0x00ffff, 0.1);
                scene.add(hemiLight);
            }

            function addModel() {

                boxModel = new THREE.BoxGeometry(3, 3, 3);

                // Load diffuse map
                boxTexture = THREE.ImageUtils.loadTexture("images/165-rock-diffuse.jpg");
                boxTexture.anisotropy = renderer.getMaxAnisotropy();

                // Load normal map
                boxNormal = THREE.ImageUtils.loadTexture("images/165-rock-normal.jpg");
                boxNormal.anisotropy = renderer.getMaxAnisotropy();

                // Set up material
                boxMaterial = new THREE.MeshPhongMaterial({
                    map: boxTexture,
                    normalMap: boxNormal
                });
                boxMaterial.shininess = 50;
                boxMaterial.specular = new THREE.Color("rgb(255, 225, 200)");

                // Create and position box
                box = new THREE.Mesh(boxModel, boxMaterial);
                box.position.set(0, 0.5, 0);
                scene.add(box);
            }

            function onWindowResize() {

                camera.aspect = container.offsetWidth / container.offsetHeight;
                camera.updateProjectionMatrix();

                renderer.setSize(window.innerWidth, window.innerHeight);
                render();
            }

            function ready() {

                // Create scene
                scene = new THREE.Scene();

                /* Add grid
                var grid = new THREE.GridHelper(2, 1);
                grid.setColors(0x333333, 0x333333);
                scene.add(grid); */

                // Set up renderer
                renderer = new THREE.WebGLRenderer({
                    antialias: true,
                    alpha: true
                });
                renderer.setClearColor(0x000000, 0);
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);

                // Add renderer to page
                container = document.getElementById('container');
                container.appendChild(renderer.domElement);

                // Set up camera 
                var aspect = container.offsetWidth / container.offsetHeight;
                camera = new THREE.PerspectiveCamera(60, aspect, 0.01, 50);

                /* Set up orbit controls
                orbit = new THREE.OrbitControls(camera, container);
                orbit.addEventListener('change', render); */

                // Set camera position
                camera.position.x = 2;
                camera.position.y = 2;
                camera.position.z = 2;

                // Set up camera target
                var target = new THREE.Vector3(0, 1, 0);
                camera.lookAt(target);
                /* orbit.target = target; */

                // Update camera
                camera.updateProjectionMatrix();

                // Add light and model
                addLight();
                addModel();

                // Add window resize listener
                window.addEventListener('resize', onWindowResize, false);
            }

            function render() {
                requestAnimationFrame(render);
                renderer.render(scene, camera);

                box.rotation.x += 0.005;
                box.rotation.y += 0.005;
            }

            // Build scene
            ready();

            // Render
            render();
        };
    </script>
</body>

</html>